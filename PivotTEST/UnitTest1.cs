using Microsoft.VisualStudio.TestTools.UnitTesting;
using Pivot;
using System.Collections.Generic;
using System.IO;

namespace PivotTEST
{
	[TestClass]
	public class UnitTest1
	{
		[TestMethod]
		public void TestCSVReader()
		{
			var csvReader = new CSVReaderSimple("dd/MM/yyyy");
			var quotes = csvReader.ReadCSVFromString(
				@"ObservationDate,Shorthand,From,To,Price
30/12/2009,Q1_10,01/01/2010,31/03/2010,0.3445
30/12/2009,Q2_10,01/04/2010,30/06/2010,0.3302
30/12/2009,Q3_10,01/07/2010,30/09/2010,0.334
30/12/2009,Q4_10,01/10/2010,31/12/2010,0.458
31/12/2009,Q1_10,01/01/2010,31/03/2010,0.3368
31/12/2009,Q2_10,01/04/2010,30/06/2010,0.3248
31/12/2009,Q3_10,01/07/2010,30/09/2010,0.329
31/12/2009,Q4_10,01/10/2010,31/12/2010,0.453
04/01/2010,Q2_10,01/04/2010,30/06/2010,0.3313
04/01/2010,Q3_10,01/07/2010,30/09/2010,0.3345
04/01/2010,Q4_10,01/10/2010,31/12/2010,0.4565
04/01/2010,Q1_11,01/01/2011,31/03/2011,0.5265
05/01/2010,Q2_10,01/04/2010,30/06/2010,0.3403
05/01/2010,Q3_10,01/07/2010,30/09/2010,0.3408
05/01/2010,Q4_10,01/10/2010,31/12/2010,0.46
05/01/2010,Q1_11,01/01/2011,31/03/2011,0.53
");

			Assert.IsTrue(quotes.Count == 16, "Count of quotes read has to be 16");
		}

		[TestMethod]
		public void TestPivotSort()
		{
			var csvReader = new CSVReaderSimple("dd/MM/yyyy");
			var quotes = csvReader.ReadCSVFromString(
				@"ObservationDate,Shorthand,From,To,Price
30/12/2009,Q1_10,01/01/2010,31/03/2010,0.3445
30/12/2009,Q2_10,01/04/2010,30/06/2010,0.3302
30/12/2009,Q3_10,01/07/2010,30/09/2010,0.334
30/12/2009,Q4_10,01/10/2010,31/12/2010,0.458
31/12/2009,Q1_10,01/01/2010,31/03/2010,0.3368
31/12/2009,Q2_10,01/04/2010,30/06/2010,0.3248
31/12/2009,Q3_10,01/07/2010,30/09/2010,0.329
31/12/2009,Q4_10,01/10/2010,31/12/2010,0.453
04/01/2010,Q2_10,01/04/2010,30/06/2010,0.3313
04/01/2010,Q3_10,01/07/2010,30/09/2010,0.3345
04/01/2010,Q4_10,01/10/2010,31/12/2010,0.4565
04/01/2010,Q1_11,01/01/2011,31/03/2011,0.5265
05/01/2010,Q2_10,01/04/2010,30/06/2010,0.3403
05/01/2010,Q3_10,01/07/2010,30/09/2010,0.3408
05/01/2010,Q4_10,01/10/2010,31/12/2010,0.46
05/01/2010,Q1_11,01/01/2011,31/03/2011,0.53
");

			var pivot = new PivotSort("dd/MM/yyyy");
			pivot.Initialize(quotes);
			var sw = new StringWriter();
			pivot.WriteTo(sw);

			sw.Close();

			var pivotSort = sw.ToString();

			var sSample = @",Q1_10,Q2_10,Q3_10,Q4_10,Q1_11
30/12/2009,0.3445,0.3302,0.334,0.458,
31/12/2009,0.3368,0.3248,0.329,0.453,
04/01/2010,,0.3313,0.3345,0.4565,0.5265
05/01/2010,,0.3403,0.3408,0.46,0.53
";

			Assert.IsTrue(pivotSort.Equals(sSample));
		}
		[TestMethod]
		public void TestPivotLINQ()
		{
			var csvReader = new CSVReaderSimple("dd/MM/yyyy");
			var quotes = csvReader.ReadCSVFromString(
				@"ObservationDate,Shorthand,From,To,Price
30/12/2009,Q1_10,01/01/2010,31/03/2010,0.3445
30/12/2009,Q2_10,01/04/2010,30/06/2010,0.3302
30/12/2009,Q3_10,01/07/2010,30/09/2010,0.334
30/12/2009,Q4_10,01/10/2010,31/12/2010,0.458
31/12/2009,Q1_10,01/01/2010,31/03/2010,0.3368
31/12/2009,Q2_10,01/04/2010,30/06/2010,0.3248
31/12/2009,Q3_10,01/07/2010,30/09/2010,0.329
31/12/2009,Q4_10,01/10/2010,31/12/2010,0.453
04/01/2010,Q2_10,01/04/2010,30/06/2010,0.3313
04/01/2010,Q3_10,01/07/2010,30/09/2010,0.3345
04/01/2010,Q4_10,01/10/2010,31/12/2010,0.4565
04/01/2010,Q1_11,01/01/2011,31/03/2011,0.5265
05/01/2010,Q2_10,01/04/2010,30/06/2010,0.3403
05/01/2010,Q3_10,01/07/2010,30/09/2010,0.3408
05/01/2010,Q4_10,01/10/2010,31/12/2010,0.46
05/01/2010,Q1_11,01/01/2011,31/03/2011,0.53
");

			var pivot = new PivotSort("dd/MM/yyyy");
			pivot.Initialize(quotes);
			var sw = new StringWriter();
			pivot.WriteTo(sw);

			sw.Close();

			var pivotLINQ = sw.ToString();

			var sSample = @",Q1_10,Q2_10,Q3_10,Q4_10,Q1_11
30/12/2009,0.3445,0.3302,0.334,0.458,
31/12/2009,0.3368,0.3248,0.329,0.453,
04/01/2010,,0.3313,0.3345,0.4565,0.5265
05/01/2010,,0.3403,0.3408,0.46,0.53
";

			Assert.IsTrue(pivotLINQ.Equals(sSample));
		}

	}
}
